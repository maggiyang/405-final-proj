var should = require('chai').should();
var request = require('request');

var redis = require("redis");
    

describe('Check running', function() {
  before(function() {
    require('./server.js');
  })
  it('Server should be running', function(done) {
    request('http://localhost:3000/', function(err, res, body) {
      res.statusCode.should.be.eql(200);
      done();
    })
  })
  it('Redis should be running', function(done) {
    this.timeout(1500);
    var client = redis.createClient();
      client.on('connect', function() {
        done();
      })
  })
})



describe('The module actually works', function() {
  
  before(function() {
    require('./server.js');
  })
  var client = redis.createClient();

  it('should store an api query in redis via get', function(done) {
    request('http://localhost:3000/api/test1', function(err, res, body) {
      res.statusCode.should.be.eql(200);
      client.get('/api/test1', function(err, reply) {
        reply.should.be.eql('test1');
        done()
      })
    })
  })

  it('should store an api query in redis via post', function(done) {
    request.post('http://localhost:3000/api/test2', function(err, res, body) {
      res.statusCode.should.be.eql(200);
      client.get('/api/test2', function(err, reply) {
        reply.should.be.eql('test2');
        done()
      })
    })
  })
  

})
