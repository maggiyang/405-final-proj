# Express-api-cache
Middleware for caching your api with Redis 


[![NPM](https://nodei.co/npm/express-api-cache.png?downloads=true)](https://nodei.co/npm/express-api-cache/)

[![Build Status](https://travis-ci.org/jacksongeller/express-api-cache.svg?branch=master)](https://travis-ci.org/jacksongeller/express-api-cache)
[![NPM version](https://badge.fury.io/js/express-api-cache.svg)](http://badge.fury.io/js/express-api-cache)




### Install
```js
npm install hiredis redis express-api-cache --save
```


### Basic Example
```js
var express = require('express');
var bodyParser = require('body-parser');
var app = express();

var redis = require("redis");
var client = redis.createClient();

var expressApiCache = require('express-api-cache');

app.use(bodyParser());
app.use(express.Router());
app.use(expressApiCache.apiCache(client));

app.get('/api/test1', function(req, res) {
  var opts = {
    client: client,
    query: req.redisQuery,
    data: 'test1',
    time: 30
  }
  expressApiCache.cacheValue(opts, function(err, data) {
    if (err) console.log(err);
    else res.send(data);
  });
})

app.listen(3000);
```


### Use
---

#### Middleware

+ For the middleware, you just need to include the node-redis instance `client` as a parameter.

+ The middleware automatically adds the property `redisQuery` to the request object if no redis reply is found.

#### CacheValue

+ For caching values if the middleware does not pick something up from redis, just call `.cacheValue`
+ takes a config option
  + `client`: // redis client
  + `query`: // the redis query you'd like to use, api cache auto adds a .redisQuery to the req obj
  + `data`: // your data
  + `time`: // the time in seconds you'd like it to expire



### Why

Let's say you have a static api that takes a long time to produce. Why not just cache it based on the query, so instead of reproducing the data and then sending it to the client, just create the data once and save it to redis for speed. 

